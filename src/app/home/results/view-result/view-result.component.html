<div class="card">

  <div class="card-header">
    <h5>View Results</h5>
    <p class="sub-header">View Exam results of any student or module</p>
  </div>

  <div class="card-body">

    <div class="row" style="margin: -20px -20px 10px -20px; height: 5px">
      <mat-progress-bar [hidden]="!viewResultsProgress" mode="query"></mat-progress-bar>
    </div>

    <form [formGroup]="viewResultsForm">

      <div class="row">

        <mat-form-field class="col-4 mx-0 px-1" appearance="outline">
          <mat-label>Keyword</mat-label>
          <input (keyup)="termModuleCode$.next($event.target.value)" (ngModelChange)="toggleProgress()" id="keyword" type="text" matInput formControlName="keyword" placeholder="Enter Student ID or Module Code" />
          <mat-error *ngIf="keyword.touched && !keyword.errors?.required && keyword.errors?.pattern">Invalid entry</mat-error>
        </mat-form-field>

        <mat-form-field class="col-8 mx-0 px-1" appearance="outline">
          <mat-label>Student ID / Module Name</mat-label>
          <input type="text" readonly matInput formControlName="moduleCodeStudentID" />
        </mat-form-field>

      </div>

      <div class="row mb-2" [style.display]="enteredKeyword === 1 ? 'block' : 'none' ">

        <mat-form-field class="col-8 mx-0 px-1" appearance="outline">
          <mat-label>Course</mat-label>
          <input type="text" readonly matInput formControlName="course" />
        </mat-form-field>

        <mat-form-field class="col-4 mx-0 px-1" appearance="outline">
          <mat-label>Academic Year</mat-label>
          <input type="text" readonly matInput formControlName="academicYear" />
        </mat-form-field>

      </div>

      <div class="row px-1 mb-4">
        <button [disabled]="keyword.invalid" (click)="getResults()" mat-raised-button color="primary" class="mx-2" type="button">View</button>
      </div>

      <div class="row px-1">
        <div *ngIf="notFound" class="alert alert-warning col">No student or Module found</div>
      </div>

      <div id="view_results" style="margin: 15px -10px 0 -10px">

        <p>View Results</p>

        <div>

          <mat-form-field>
            <mat-label>Module Code</mat-label>
            <input matInput placeholder="Ex: IN5101" (keyup)="filter($event)" #input />
          </mat-form-field>

          <table mat-table [dataSource]="dataSource" style="width: 100%">

            <!-- # Column -->
            <ng-container matColumnDef="no">
              <th mat-header-cell *matHeaderCellDef> # </th>
              <td mat-cell *matCellDef="let element; let i = index">{{ i + 1 }}&nbsp;&nbsp;&nbsp;</td>
            </ng-container>

            <!-- # Module Code -->
            <ng-container matColumnDef="moduleCode">
              <th mat-header-cell *matHeaderCellDef>Module Code</th>
              <td mat-cell *matCellDef="let element">{{ element.moduleCode }}</td>
            </ng-container>

            <!-- # Module Name -->
            <ng-container matColumnDef="moduleName">
              <th mat-header-cell *matHeaderCellDef>Module Name</th>
              <td mat-cell *matCellDef="let element">{{ element.moduleName }}</td>
            </ng-container>

            <!-- # Module Name -->
            <ng-container matColumnDef="studentID">
              <th mat-header-cell *matHeaderCellDef>Student Index</th>
              <td mat-cell *matCellDef="let element">{{ element.studentID }}</td>
            </ng-container>

            <!-- # Academic Year -->
            <ng-container matColumnDef="academicYear">
              <th mat-header-cell *matHeaderCellDef>Academic Year</th>
              <td mat-cell *matCellDef="let element">{{ element.academicYear }}</td>
            </ng-container>

            <!-- # Date Held -->
            <ng-container matColumnDef="dateHeld">
              <th mat-header-cell *matHeaderCellDef>Date Held</th>
              <td mat-cell *matCellDef="let element">{{ element.dateHeld | date: 'MMM dd, yyyy' }}</td>
            </ng-container>

            <!-- # Marks -->
            <ng-container matColumnDef="marks">
              <th mat-header-cell *matHeaderCellDef>Marks</th>
              <td mat-cell *matCellDef="let element">{{ element.mark }}</td>
            </ng-container>

            <!-- # Grade -->
            <ng-container matColumnDef="grade">
              <th mat-header-cell *matHeaderCellDef>Grade</th>
              <td mat-cell *matCellDef="let element">{{ element.grade }}</td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

            <tr class="mat-row" *matNoDataRow>
              <td [colSpan]="displayedColumns.length">No data found</td>
            </tr>

          </table>

        </div>

      </div>

    </form>

  </div>

</div>
